# 小地图探索系统 - 迭代归档

**迭代时间**：2026-01-14 ~ 2026-01-16  
**状态**：✅ 已完成

## 迭代目标
实现类《勇者斗恶龙》风格的网格化小地图探索系统，包含玩家移动、怪物遭遇、战斗触发和程序化地图生成。

## 完成功能
- ✅ **网格探索界面**：20x15格可视区域，200x150格大地图
- ✅ **玩家移动**：WASD/方向键控制，支持碰撞检测
- ✅ **怪物遭遇**：
  - 显性怪物：地图可见，碰撞触发
  - 隐性怪物：移动概率触发 (15%)
- ✅ **战斗衔接**：无缝跳转战斗界面，战后返回小地图
- ✅ **程序化生成**：使用 Digger 算法动态生成 100% 连通的随机地牢
- ✅ **性能优化**：视口裁剪 (Frustum Culling) 和 Int8Array 数据结构

## 技术亮点
- **视口裁剪**：只渲染屏幕可见区域，大幅提升大地图渲染性能 (>60 FPS)
- **程序化生成**：集成 Digger 算法和洪水填充检测，保证地图质量和连通性
- **兼容架构**：设计了兼容一维数组和二维数组的 Helper 函数，平滑过渡数据结构

## 遇到问题和解决方案
| 问题 | 解决方案 |
|------|----------|
| 战斗触发报错 `levelRange is not iterable` | 修复参数传递，将单个等级转换为数组 |
| 战斗后未返回小地图 | 在 store 中添加 `isInCombat` 状态标记来源 |
| 大地图访问越界 | 使用模运算平铺纹理，后升级为程序化生成 |
| 渲染帧率低 | 实现 Canvas 视口裁剪，只绘制可见区域 |

## 相关文档
- [详细计划](./plan.md)
- [任务清单](./task.md)
- [实现总结](./walkthrough.md)
- [程序化生成任务](./map-generator-task.md)
