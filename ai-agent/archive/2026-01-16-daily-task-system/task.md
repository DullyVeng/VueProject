# 每日任务系统 - 开发任务清单

**版本**：v1.2（经验翻倍+采集任务）  
**开始时间**：2026-01-16  
**预计完成**：1天

---

## ✅ 已完成的核心特性

1. ❌ 移除温养任务类型
2. ✅ 击杀任务随机化（怪物类型+数量）
3. ✅ 采集任务随机化（物品类型+数量+等级分层）
4. ✅ 经验奖励翻倍（完成全部任务≈72%升级经验）
5. ✅ 动态奖励计算（基于等级和难度）
6. ✅ 任务系统分离（独立于剧情任务）

---

## 📋 开发进度

### 阶段 1：基础架构 ✅

- [x] 创建数据库表
  - [x] `daily_task_progress` 表（Supabase）
  - [x] RLS策略
  - [x] 索引优化
- [x] 创建 `dailyTasks.js`
  - [x] 任务类型枚举（5种）
  - [x] 采集物品分级配置（低/中/高）
  - [x] 奖励计算函数（经验×8，灵石×4）
  - [x] 怪物击杀生成器
  - [x] 采集任务生成器
  - [x] 权重随机选择
- [x] 创建 `daily.js` store
  - [x] 状态定义
  - [x] 加载/初始化逻辑
  - [x] 进度更新（支持ID匹配）
  - [x] 奖励领取
  - [x] 跨天检测

### 阶段 2：核心逻辑 ✅

- [x] 随机任务生成
  - [x] 根据等级筛选可用怪物（±20级范围）
  - [x] 根据等级选择采集物品等级
  - [x] 数量动态计算（±30%浮动）
  - [x] 权重随机选择（5种任务类型）
- [x] 动态奖励计算
  - [x] 单任务：等级 × 8 × 难度
  - [x] 全完成：等级 × 10（经验）+ 等级 × 6（灵石）
  - [x] ±20%随机浮动
- [x] 进度更新
  - [x] 怪物ID精确匹配
  - [x] 物品ID精确匹配
  - [x] 'any' 通配符支持
  - [x] BOSS判定
- [x] 奖励领取
  - [x] 单任务领取（调用characterStore）
  - [x] 全完成奖励（需先领取所有任务）
  - [x] 数据库状态同步

### 阶段 3：UI界面 ✅

- [x] `DailyTaskPanel.vue` 组件
  - [x] 任务卡片（图标+名称+描述）
  - [x] 进度条（百分比显示）
  - [x] 奖励标签（经验+灵石）
  - [x] 领取按钮（动态状态）
  - [x] 全完成奖励模块（呼吸动画）
  - [x] 已完成标记
- [x] 样式美化
  - [x] 玻璃拟态背景
  - [x] 渐变按钮
  - [x] 微动画效果
  - [x] 响应式布局
- [x] 主界面集成
  - [x] 在 `HomeView.vue` 右上角显示
  - [x] 自动加载任务

### 阶段 4：系统集成 ✅

- [x] 战斗系统集成（`combat.js`）
  - [x] 战斗胜利 → 更新战斗任务
  - [x] 击杀怪物 → 传递怪物ID
  - [x] BOSS击杀 → 更新BOSS任务
  - [x] 导入dailyStore和DailyTaskType
- [x] 法宝强化集成（`fabao.js`）
  - [x] 强化成功 → 更新强化任务
  - [x] 强化失败 → 也计入进度
  - [x] 导入dailyStore和DailyTaskType
- [x] 物品采集集成（`inventory.js`）
  - [x] 获得物品 → 更新采集任务
  - [x] 传递物品ID和数量
  - [x] 导入dailyStore和DailyTaskType

### 阶段 5：测试完善 🔄

- [ ] 功能测试
  - [ ] 新用户首次登录生成任务
  - [ ] 任务随机性验证
  - [ ] 战斗完成后进度更新
  - [ ] 法宝强化后进度更新
  - [ ] 采集物品后进度更新
  - [ ] 奖励领取流程
  - [ ] 全完成奖励领取
  - [ ] 跨天刷新
- [ ] 浏览器测试
  - [ ] UI交互流畅性
  - [ ] 动画效果
  - [ ] 响应式布局
- [ ] Bug修复
- [ ] 文档更新

---

## 📝 待办事项

1. 运行开发服务器并测试
2. 创建测试角色验证任务生成
3. 完成一次完整的任务流程
4. 验证跨天刷新机制
5. 检查经验奖励是否符合预期（72%/天）

---

## � 已知问题

（测试中记录）

---

## 📌 备注

- 经验翻倍后，每日完成全部任务约获得72%升级经验
- 采集任务分三级：低级（灵草/铁矿）、中级（青灵草/银矿）、高级（寒冰莲/火焰精华）
- 所有任务类型都已集成到对应系统
