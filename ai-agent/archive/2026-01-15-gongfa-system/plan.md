# 筑基期功法系统 - 开发规划

**版本**：v0.4.0  
**开始时间**：2026-01-14  
**更新时间**：2026-01-15  
**预计完成**：4-5个会话

---

## 目标

实现完整的筑基期功法系统，包括：
1. **境界晋升系统** - 实现从炼气期晋升到筑基期
2. **识海系统** - 功法存储空间
3. **功法羁绊机制** - 同派系功法增益
4. **境界任务** - 通过任务解锁筑基期并获得首个功法

---

## 核心设计

### 1. 境界晋升系统（新增）
- 炼气期满级后可突破到筑基期
- 突破需要消耗灵石和达到指定等级
- 突破成功解锁识海系统

### 2. 识海系统（类比丹田）
- 筑基期解锁识海栏位
- 识海容量由**神识**属性决定（基础容量 + 神识加成）
- 功法占用识海格子

### 3. 功法系统
- 功法存放在识海中
- 每个功法有对应的**派系**（剑修、道修、佛修等）
- 功法提供属性加成

### 4. 功法羁绊
- 2本剑修功法：攻击速度提升10%
- 4本剑修功法：剑气溅射30%
- 6本剑修功法：额外触发剑影攻击

### 5. 功法获取（新增）
- **境界任务**：炼气期满级后可接取"突破境界"任务
- **任务奖励**：完成筑基期突破任务，奖励首个功法（御剑诀）
- **打怪掉落**：后续功法可通过打怪获得（本迭代暂不实现）

---

## 范围定义

### 本迭代实现（扩展版）

#### Phase 0：境界晋升系统
1. **晋升逻辑**
   - 境界突破条件检查
   - 境界突破消耗（灵石、等级）
   - 突破成功处理

2. **晋升任务**
   - 筑基任务配置（quest_realm_zhuji）
   - 任务奖励首个功法
   - 任务UI显示

3. **UI优化**
   - 境界晋升按钮
   - 识海按钮未解锁提示

#### Phase 1：数据层
- 功法配置表（静态数据）
- 功法实例表（数据库）
- 识海属性扩展

#### Phase 2：核心逻辑
- 功法store（增删查改）
- 识海容量计算
- 功法派系定义

#### Phase 3：UI组件
- 识海视图
- 功法卡片组件
- 功法详情弹窗
- 羁绊面板

#### Phase 4：羁绊与集成
- 剑修功法羁绊（2/4/6级）
- 羁绊效果计算与应用

### 本迭代不实现（后续迭代）
- 功法进化/进阶
- 功法与法宝联动
- 打怪掉落功法
- 多派系羁绊（仅实现剑修）

---

## 阶段划分

### 阶段0：境界晋升系统（新增优先）
- [ ] 境界突破条件设计
- [ ] character.js 添加 advanceRealm() 方法
- [ ] 境界突破任务配置
- [ ] 境界UI（显示当前境界、突破按钮）
- [ ] 识海入口解锁检查与提示

### 阶段1：数据层设计
- [ ] `data/gongfas.js` 功法配置
- [ ] `data/gongfaSchools.js` 派系定义
- [ ] `data/gongfaBonds.js` 羁绊配置
- [ ] 数据库表设计与SQL

### 阶段2：Store层实现
- [ ] gongfa.js store
- [ ] 识海容量计算
- [ ] 羁绊计算逻辑

### 阶段3：UI实现
- [ ] ShihaiView.vue 主视图
- [ ] GongfaCard.vue 功法卡片
- [ ] 羁绊面板

### 阶段4：集成与验证
- [ ] 境界解锁检查
- [ ] 战斗系统集成
- [ ] 完整功能测试

---

## 技术设计

### 境界突破逻辑

```javascript
// 突破条件
const REALM_REQUIREMENTS = {
    zhuji: {
        fromRealm: 'lianqi',
        fromRealmLevel: 10,      // 炼气期满级
        requiredLevel: 10,       // 角色等级10
        silverCost: 1000,        // 消耗1000灵石
        requiredQuest: 'quest_realm_zhuji'  // 需要完成突破任务
    }
}

// 突破方法
async function advanceRealm(targetRealm) {
    // 1. 检查条件
    // 2. 扣除灵石
    // 3. 更新境界
    // 4. 解锁系统
}
```

### 境界任务配置

```javascript
{
    id: 'quest_realm_zhuji',
    name: '筑基之路',
    type: 'realm',  // 新类型：境界任务
    description: '你已修炼有成，是时候突破筑基了。前往长老处进行突破仪式。',
    
    requirements: {
        level: 10,
        realm: 'lianqi',
        realmLevel: 10
    },
    
    objectives: [
        { type: 'realm_advance', target: 'zhuji', description: '突破筑基期' }
    ],
    
    rewards: {
        items: [{ id: 'gongfa_yujian_jue', quantity: 1 }],  // 奖励御剑诀
        unlocks: ['shihai']  // 解锁识海
    }
}
```

---

## 成功标准

1. ✅ 玩家可以从炼气期突破到筑基期
2. ✅ 完成境界任务获得首个功法
3. ✅ 筑基期后可以进入识海界面
4. ✅ 非筑基期点击识海显示提示
5. ✅ 功法可装备到识海
6. ✅ 功法羁绊正确计算
