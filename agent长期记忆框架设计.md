# Agent 驱动开发架构说明（可复用模板）

> 本文档用于在任意项目中 **快速生成一套稳定、低上下文消耗的 AI Agent 协作开发架构**  
> 适用于 IDE / antigravity / Claude / GPT 等 Agent 场景

---

## 一、架构目标（你必须理解的设计前提）

本架构的核心目标只有三点：

1. **人只负责“意图”，AI 负责“流程”**
2. **不依赖历史对话，随时可冷启动新会话**
3. **最小化自动加载内容，避免 Token 被流程说明吃掉**

核心原则一句话总结：

> **文档是唯一记忆，task.md 是唯一上下文，历史对话可以随时丢弃**

---

## 二、架构整体组成（三层结构）

### ① 自动加载层（唯一强制）

#### `agents.md`

- Agent 的**最高优先级行为约束**
- 在新会话中 **自动加载**
- 内容必须：
  - 简短
  - 不可违背
  - 不包含模板或示例
- 作用：  
  **决定 AI“能做什么 / 不能做什么 / 何时该停”**

> ⚠️ 项目中只能有一个 `agents.md`，且必须放在项目根目录

---

### ② 工作记忆层（AI 自动维护）

#### `ai-agent/current/`

这是 **当前正在进行的迭代空间**，由 AI 自动创建和维护。

**每次只允许存在一个进行中的迭代。**

标准结构：

```

ai-agent/current/<feature-name>/
├── task.md              # ⭐ 唯一上下文来源（必须包含“下一步行动”）
├── plan.md              # 目标、范围、阶段
├── implementation.md    # 技术实现与文件变更
├── requirements.md      # 需求说明

```

其中：

- **task.md 是唯一必须依赖的文件**
- 新会话、新模型、新 IDE，都必须能仅靠 task.md 继续工作

---

### ③ 归档层（长期记忆）

#### `ai-agent/archive/`

- 所有已完成的功能迭代统一归档
- 归档后不再被自动读取
- 只作为：
  - 历史参考
  - 决策回溯
  - 成果留存

归档路径规范：

```

ai-agent/archive/YYYY-MM-DD-feature-name/

````

---

## 三、核心文件职责说明（非常重要）

### 📄 agents.md（强制规则）

- 定义：
  - 语言
  - 工具
  - 角色
  - 上下文优先级
  - 归档规则
- 不写：
  - 操作教程
  - 示例
  - 模板

---

### 📄 task.md（唯一上下文）

必须包含以下内容：

```markdown
## ⏭️ 下一步行动
明确说明：当前应该做什么 + 为什么

## 待完成 / 进行中 / 已完成
任务状态列表

## 遇到的问题
阻塞点或已知风险
````

> **新会话 = 只读 task.md → 直接继续工作**

---

## 四、使用方式（给人的最小操作集）

### 1️⃣ 开始一个新功能迭代

你只需要对 AI 说一句话：

> **开始一个新的迭代开发：<功能名称>**

AI 必须自动：

* 创建 `ai-agent/current/<功能名>/`
* 创建并初始化所有核心文档
* 在 task.md 中写清楚「下一步行动」

❌ 不要手动创建任何目录或文件

---

### 2️⃣ 开发过程中

你只需要说：

* `继续`
* 或 `按 task.md 的下一步行动继续`

不要：

* 复述背景
* 总结历史对话
* 提醒 AI 有什么机制

---

### 3️⃣ 完成一个迭代

你只需要说：

> **这个迭代完成，归档并准备下一个功能**

AI 必须自动：

* 归档到 `ai-agent/archive/`
* 清空 `ai-agent/current/`
* 更新 current 下的状态说明文件
* 等待新任务

---

## 五、上下文管理原则（防失忆关键）

当发生以下任一情况：

* 上下文使用 > 70%
* 会话轮次过多
* 感觉“记不清前面内容”

AI 必须：

1. 停止继续对话
2. 更新 task.md（进度 + 下一步）
3. 提示用户开启新会话并说「继续」
4. **禁止总结历史对话**

---

## 六、禁止行为（架构红线）

以下行为会破坏整个系统：

* ❌ 手动创建或修改 `ai-agent/current/`
* ❌ 让 AI 总结历史对话作为“记忆”
* ❌ 同时存在多个未归档的迭代
* ❌ 把流程说明写进 agents.md

---

## 七、如何在新项目中复用这套架构

### 标准做法（推荐）

1. 将本说明文档复制给 AI
2. 对 AI 说：

> **请为当前项目生成一套 Agent 驱动开发架构，并创建 agents.md**

3. 检查：

   * agents.md 是否存在
   * ai-agent/ 目录是否生成
   * agents.md 是否精简且为硬约束

---

## 八、终极原则（只记住这一句也够）

> **Agent 的稳定性，不来自“多记住”，而来自“随时可丢弃”。**

---


```
