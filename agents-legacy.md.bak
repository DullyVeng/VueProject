# AI Agent 工作指南

> 本文档是AI Agent的核心工作准则，新会话启动时会自动加载。

---

## 一、AI 工作准则

### 基本规范
1. **语言规范**：所有工作沟通、汇报、Plan、Commit message必须使用中文
2. **项目背景**：这是一个修仙类型RPG游戏，设计时必须符合修仙题材设定
3. **代码质量**：每次代码编写或修改后，必须进行语法自检，确保无语法错误

### 数据库操作规范
4. **SQL注释**：所有字段和表的comment必须用中文说明用途
5. **使用Supabase MCP**：数据库操作必须使用Supabase MCP工具
6. **项目ID**：本项目Supabase ID为 `xufhdurllimdmymuplox`，无需查询

### 文档规范
7. **中文优先**：Plan、总结、分析、任务清单必须使用中文
8. **验证数据**：涉及数据验证时，使用Supabase MCP进行验证

---

## 二、Agent 角色定义

### 1. code-explorer
- **作用**：专职查找项目中的相关代码、函数、类、文件路径
- **注意**：只输出定位信息和关键片段，不写实现代码
- **使用场景**：任务拆分时定位逻辑、查找复用、定位 bug

### 2. code-architect
- **作用**：架构设计与方案评估
- **注意**：输出模块拆分、接口设计和潜在风险分析，不写实现代码
- **使用场景**：任务拆分阶段、设计确认、需求临时调整

### 3. code-reviewer
- **作用**：代码审查
- **注意**：关注可维护性、边界条件、潜在 bug、回归风险
- **使用场景**：每个 Task 完成后或提测前的系统性 CR

---

## 三、迭代长期记忆机制

> 使用此机制避免因上下文过长导致的会话失忆问题

### 何时创建迭代记忆
- 开始一个大版本功能迭代时
- 预计需要多次会话才能完成的功能
- 复杂功能需要分阶段实现时

### 迭代文件夹结构

在`ai-agent/current/`创建迭代文件夹：

```
ai-agent/current/feature-name/
├── plan.md              # 迭代计划（目标、范围、阶段划分）
├── task.md              # 任务清单（待办、进行中、已完成）
├── requirements.md      # 需求描述文档
├── implementation.md    # 技术实现文档
└── notes.md             # 实现过程笔记（可选）
```

### 文档内容规范

#### 1. plan.md - 迭代计划
```markdown
# [功能名称] 迭代计划

## 迭代目标
- 总体目标描述
- 预期成果

## 迭代范围
- 包含的功能点
- 不包含的内容（边界）

## 阶段划分
### 阶段一：[名称]
- 任务列表
- 预计时间

### 阶段二：[名称]
- 任务列表
- 预计时间

## 技术栈
- 使用的技术和工具

## 风险点
- 潜在问题和应对方案
```

#### 2. task.md - 任务清单
```markdown
# [功能名称] 任务清单

## 待完成
- [ ] 任务1
- [ ] 任务2

## 进行中
- [/] 任务3 (当前进度说明)

## 已完成
- [x] 任务4 (完成时间: YYYY-MM-DD)
- [x] 任务5 (完成时间: YYYY-MM-DD)

## 下一步行动
> 明确下一个会话应该从哪里开始

## 遇到的问题
- 问题描述和解决方案
```

#### 3. requirements.md - 需求描述
```markdown
# [功能名称] 需求文档

## 功能概述
- 功能描述
- 用户价值

## 用户故事
作为[角色]，我想要[功能]，以便[目的]

## 功能详细说明
### 功能点1
- 描述
- 输入/输出
- 业务规则

## UI/UX要求
- 界面设计要求
- 交互流程

## 验收标准
- 功能完成的标准
```

#### 4. implementation.md - 技术实现
```markdown
# [功能名称] 技术实现文档

## 技术方案
- 架构设计
- 技术选型

## 数据库设计
### 新增表
| 表名 | 说明 | 字段 |
|------|------|------|

### 修改表
| 表名 | 修改内容 | 说明 |
|------|----------|------|

## API设计
- 接口列表

## 文件变更
### 新增文件
- `path/to/file.js` - 说明

### 修改文件
- `path/to/file.js` - 修改内容

## 关键代码说明
- 重要逻辑的实现思路

## 已完成功能
- [x] 功能1 - 实现说明
- [x] 功能2 - 实现说明

## 待实现功能
- [ ] 功能3 - 计划说明
```

### 使用流程

#### 开始新迭代
1. 创建迭代文件夹：`ai-agent/current/feature-name/`
2. 创建四个核心文档：plan.md、task.md、requirements.md、implementation.md
3. 填写初始内容（目标、需求、计划）

#### 迭代过程中
1. **每完成一个功能**：
   - 更新`task.md`中的任务状态
   - 更新`implementation.md`中的已完成功能
   - 记录重要决策和问题到`notes.md`

2. **每次会话结束前**：
   - 更新"下一步行动"，明确下次从哪里开始
   - 确保所有进度已记录

3. **新会话开始时**：
   - 读取`task.md`查看当前进度
   - 读取"下一步行动"继续工作
   - 如需详细信息，查阅其他文档

#### 迭代完成后
1. 将整个文件夹移动到`ai-agent/archive/YYYY-MM-DD-feature-name/`
2. 清理`ai-agent/current/`目录
3. 生成最终的归档README.md

### 长期记忆恢复示例

**场景**：上下文达到极限，需要新会话继续

**操作步骤**：
1. 新会话启动，读取`agents.md`（自动）
2. 查看`ai-agent/current/`目录，找到正在进行的迭代
3. 读取`task.md`了解当前进度
4. 根据"下一步行动"继续工作
5. 如需详细信息，读取相关文档

**AI提示词示例**：
```
@current/feature-name/task.md 请查看当前任务进度
@current/feature-name/implementation.md 查看技术实现详情
```

### 最佳实践

1. **及时更新**：每完成一个小功能就更新文档
2. **明确下一步**：永远在task.md中写清楚"下一步行动"
3. **记录决策**：重要的技术决策和问题解决方案要记录
4. **保持简洁**：文档要精炼，避免冗长
5. **使用模板**：参考`ai-agent/templates/`中的模板

---

## 四、迭代归档流程

### 何时归档
- 每个功能迭代完成并测试通过后
- 用户明确表示"完成迭代"或"继续下一个功能"时

### 归档步骤

#### 1. 创建归档文件夹
- **路径**：`ai-agent/archive/YYYY-MM-DD-feature-name/`
- **命名格式**：日期-功能名称（英文，小写，用连字符分隔）
- **示例**：`2026-01-13-sect-foundation-system/`

#### 2. 生成归档文档
在归档文件夹中创建`README.md`，内容包括：
- 迭代目标和完成功能
- 新增/修改文件清单
- 修复的问题
- 技术亮点
- 测试结果
- 后续优化建议

#### 3. 移动相关文档
- 将项目根目录或src中的临时总结文档移动到归档文件夹
- 示例：`web-client/xxx-完成总结.md` → `archive/YYYY-MM-DD-xxx/完成总结.md`

#### 4. 清理current文件夹
- 如果`ai-agent/current/`中有本次迭代相关的临时文档，移动到归档文件夹
- 如果没有相关文档，则无需操作

#### 5. 归档位置规则
- ❌ 不要将总结文档放在`web-client/src/`或项目根目录
- ✅ 所有迭代文档统一归档到`ai-agent/archive/`
- ✅ 代码示例可以保留在`src/`中（如`*-examples.js`）

### 归档文档模板
参考：`ai-agent/templates/task-template.md`

### 归档后的清理
- 删除项目根目录和src中的临时总结文档
- 保留代码文件和示例文件
- 确保归档文件夹包含完整的迭代记录

---

## 四、扩展阅读

以下文档按需引用，不需要每次都加载：

### 项目规范
- [游戏素材目录规范](ai-agent/guidelines/asset-structure.md) - 游戏资源存放规则
- [Supabase MCP 使用指南](ai-agent/guides/supabase-mcp.md) - 数据库操作详细说明

### 工作流程
- [AI-docs 工作流逻辑](ai-agent/workflows/ai-docs-workflow.md) - 文档生成流程

### 模板
- [任务模板](ai-agent/templates/task-template.md) - 任务文档模板

### 项目文档
- [核心玩法设计文档](web-client/核心玩法设计文档.md) - 游戏功能设计
- [功能实现状态](web-client/功能实现状态.md) - 当前实现进度

---

## 五、快速参考

### Supabase 项目信息
- **Project ID**: `xufhdurllimdmymuplox`
- **操作方式**: 使用 Supabase MCP 工具

### 目录结构
```
JavaProject/
├── agents.md                    # 本文档（核心准则）
├── web-client/                  # 前端项目
│   ├── src/                     # 源代码
│   └── 核心玩法设计文档.md      # 功能设计
└── ai-agent/                    # AI工作文档
    ├── archive/                 # 迭代归档
    ├── current/                 # 当前工作文档
    ├── guidelines/              # 规范指南
    ├── guides/                  # 操作指南
    ├── roles/                   # 角色定义
    ├── templates/               # 文档模板
    └── workflows/               # 工作流程
```

### 常用命令
- **启动开发服务器**: `npm run dev` (在 web-client 目录)
- **数据库操作**: 使用 Supabase MCP 工具
- **归档迭代**: 创建 `ai-agent/archive/YYYY-MM-DD-feature-name/`

---

## 六、注意事项

1. **新会话启动时**，AI会自动读取本文档
2. **扩展文档**只在需要时引用，避免Token浪费
3. **归档流程**必须严格执行，保持项目文档整洁
4. **中文优先**，所有面向用户的内容必须使用中文
5. **代码质量**，提交前必须自检，确保无语法错误

---

*最后更新：2026-01-13*